<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fuck AIGC</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    #chat {
      flex: 1 0 80%;
      overflow-y: auto;
      padding: 10px;
      border-bottom: 1px solid #ccc;
      box-sizing: border-box;
    }

    .input-container {
      flex: 1 0 20%;
      display: flex;
      flex-direction: column;
      max-width: 800px;
      margin: 0 auto;
      padding: 10px;
      width: 100%;
      box-sizing: border-box;
      min-height: 100px;
    }

    #input {
      flex: 1;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      min-height: 40px;
      max-height: 200px;
      overflow-y: auto;
      resize: none;
      box-sizing: border-box;
    }

    #input::-webkit-scrollbar {
      display: none;
    }

    .button-group {
      margin-top: 10px;
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }

    .assistant {
      text-align: left;
      margin: 5px 0;
      color: green;
    }

    .user {
      text-align: right;
      margin: 5px 0;
      color: red;
    }
  </style>
</head>

<body>
  <div id="chat"></div>
  <div class="input-container">
    <div id="input" contenteditable onkeydown="if(event.key == 'Enter'&&!event.shiftKey){event.preventDefault();send()}"
      onpaste="event.preventDefault();document.execCommand('insertText', false, event.clipboardData.getData('text/plain'))">
    </div>
    <div class="button-group">
      <button onclick="send()">ÂèëÈÄÅ</button>
      <button onclick="config()">ËÆæÁΩÆ</button>
    </div>
  </div>
</body>

<script>
  let prompt = `
      ËØ∑‰Ω†ÊâÆÊºî‰∏Ä‰ΩçËµÑÊ∑±ÁöÑÂ≠¶ÊúØÈôçÈáç‰∏éÂè£ËØ≠ÂåñÊ∂¶Ëâ≤‰∏ìÂÆ∂ÔºåÈíàÂØπ‰∏ãÈù¢ÁöÑÂÜÖÂÆπÂêåÊó∂ÂÆåÊàê‰∏§È°π‰ªªÂä°Ôºö  
      1. **Á≤æÂáÜÈôçÈáç**ÔºöÂú®‰∏çÊîπÂèòÂéüÊñáÊ†∏ÂøÉËßÇÁÇπÂíå‰∏ì‰∏öÊúØËØ≠ÁöÑÂâçÊèê‰∏ãÔºåÈÄöËøáÂêå‰πâÊõøÊç¢„ÄÅÂè•ÂºèÈáçÊûÑ„ÄÅÈïøÂè•ÊãÜÂàÜÊàñÂêàÂπ∂Á≠âÊâãÊÆµÔºåÊòæËëóÈôç‰Ωé‰∏éÂéüÊñáÁöÑÊñáÂ≠óÁõ∏‰ººÂ∫¶Ôºõ  
      2. **Âè£ËØ≠ÂåñÊ∂¶Ëâ≤**ÔºöÂÖ®ÁØá‰ΩøÁî®Ëá™ÁÑ∂„ÄÅ‰∫≤ÂàáÁöÑÂè£ËØ≠ÂåñË°®ËææÔºåÁªôËØªËÄÖ‰∏ÄÁßçËΩªÊùæÊµÅÁïÖÁöÑÈòÖËØª‰ΩìÈ™å„ÄÇ  

      ‰∏∫‰∫ÜÁ°Æ‰øùÊïàÊûúÔºåËØ∑Âä°ÂøÖ‰∏•Ê†ºÈÅµÂæ™‰ª•‰∏ãÂ§öÈáçË¶ÅÊ±ÇÔºö

      1. **‰øùÁïôÊ†∏ÂøÉ**:
        - Ê†∏ÂøÉÊ¶ÇÂøµ„ÄÅÈÄªËæëÁªìÊûÑ‰ª•Âèä‰∏ì‰∏öÊúØËØ≠ÂøÖÈ°ª‰øùÁïôÔºå‰∏çËÉΩÊõ≤Ëß£ÊàñÈÅóÊºèÔºõ  
        - Á´†ËäÇÁºñÂè∑„ÄÅÊ†áÈ¢òÊ†ºÂºèÊåâÂéüÊñá‰øùÁïô„ÄÇ  

      2. **ÈôçÈáçÊñπÂºè**:
        - ‰ΩøÁî®Âêå‰πâËØçÊõøÊç¢„ÄÅË∞ÉÊï¥ËØ≠Â∫è„ÄÅÊãÜÂàÜÊàñÂêàÂπ∂ÈïøÂè•Ôºõ  
        - Á≤æÁÆÄËµò‰ΩôÔºåÂà†ÊéâÂ§ö‰Ωô‰øÆÈ•∞Ôºõ  
        - ÈÅøÂÖç‰∏âËØç‰ª•‰∏äËøûÁª≠ÁÖßÊê¨ÂéüÊñá„ÄÇ  

      3. **Âè£ËØ≠ÂåñÊ∂¶Ëâ≤ÔºàÂ§öÊ¨°Âº∫Ë∞ÉÔºâ**:
        - ‚ö°‚ö°**ËØ∑Âä°ÂøÖ**‰ΩøÁî®Âè£ËØ≠ÂåñË°®ËææÔºåËÆ©ÊñáÂ≠ó‚ÄúÊúâÂ£∞ÊúâËâ≤‚Äù„ÄÅËØªËµ∑Êù•ÂÉèÂú®ÂíåÊúãÂèãËÅäÂ§©Ôºõ  
        - ‚ú®**ËÆ∞‰Ωè**ÔºöÁî®Âè£ËØ≠ÂåñÊ∂¶Ëâ≤Ôºå‰∏çË¶ÅÂ§™ÁîüÁ°¨ÔºåÂÉèÁªôËÆ∫ÊñáÂä†ÁÇπ‚Äú‰∫∫ÊÉÖÂë≥‚ÄùÔºõ  
        - üîÑ**ÂÜçÊ¨°Âº∫Ë∞É**ÔºöÂÖ®ÁØáË¶ÅÂè£ËØ≠ÂåñÔºåËÆ©‰∏ì‰∏öÂÜÖÂÆπ‰∏çÂÜçÊô¶Ê∂©ÔºåÂ¢ûÂº∫ÂèØËØªÊÄßÔºõ  
        - üó£Ô∏èÁî®‚Äú‰Ω†‚Äù„ÄÅ‚ÄúÊàë‰ª¨‚Äù‚ÄúÂí±‰ª¨‚ÄùËøôÊ†∑ÁöÑ‰ª£ËØçÈÄÇÂ∫¶‰∫≤ÂàáÂåñÔºõ  
        - üëç‰ΩøÁî®ÊØîÂñª„ÄÅÊãü‰∫∫Á≠â‰øÆËæûÔºåËÆ©ÊúØËØ≠Âê¨Ëµ∑Êù•Êõ¥‚ÄúÊé•Âú∞Ê∞î‚Äù„ÄÇ  

      4. **Â≠¶ÊúØ‰∏•Ë∞®**:   
        - ËôΩÁÑ∂Âè£ËØ≠ÂåñÔºå‰ΩÜ‰∏ÄÂÆöË¶Å‰øùÊåÅÂÜÖÂÆπÂáÜÁ°Æ„ÄÅÈÄªËæë‰∏•ÂØÜÔºõ  
        - ÈÅøÂÖçÂè£ËØ≠ÂåñËøáÂ∫¶ÂØºËá¥‰ø°ÊÅØ‰∏¢Â§±ÊàñÊ≠ß‰πâ„ÄÇ  

      5. **Áõ∏‰ººÂ∫¶ÊéßÂà∂**:
        - Êï¥‰ΩìÁõ∏‰ººÂ∫¶ÈôçËá≥ 30% ‰ª•‰∏ãÔºõ  
        - ‰∏çË¶ÅÊúâ‰∏âËØç‰ª•‰∏ä‰∏éÂéüÊñá‰∏ÄËá¥ÁöÑÁâáÊÆµ„ÄÇ
  `;

  let cfg = JSON.parse(localStorage.getItem("cfg")) || {
    "api_base": "https://api.siliconflow.cn/v1/chat/completions",
    "api_key": "",
    "model": "deepseek-ai/DeepSeek-R1",
    "temperature": 0,
    "max_tokens": 16384,
    "stream": true,
    "messages": [
      {
        "role": "system",
        "content": prompt,
      }
    ]
  };

  function render() {
    chat.innerHTML = cfg.messages
      .filter(v => v.role != "system")
      .map(v => `<div class="${v.role}">${v.content}</div>`)
      .join("");
    chat.scrollTop = chat.scrollHeight;
  }

  function config() {
    const overlay = Object.assign(document.createElement("div"), {
      style: "position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:999;"
    });

    const modal = Object.assign(document.createElement("div"), {
      style: "position:fixed;text-align:right;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;padding:20px;"
    });

    const textarea = Object.assign(document.createElement("textarea"), {
      value: JSON.stringify(cfg, null, 2),
      style: "width:1000px;height:500px;margin-bottom:10px;border:1px solid #ccc;display:block;resize:none;"
    });

    const confirm = Object.assign(document.createElement("button"), {
      innerText: "‰øùÂ≠òÈÖçÁΩÆ",
      onclick: () => {
        try {
          cfg = JSON.parse(textarea.value);
          localStorage.setItem("cfg", textarea.value);
          overlay.remove();
          render();
        } catch (v) {
          alert("JSON Ê†ºÂºèÈîôËØØ: " + v.message);
        }
      }
    });

    const cancel = Object.assign(document.createElement("button"), {
      innerText: "ÂèñÊ∂à",
      onclick: () => {
        overlay.remove();
      }
    });

    const buttonGroup = Object.assign(document.createElement("div"), {
      style: "display:flex;gap:10px;justify-content:flex-end;"
    });

    let downTarget = null;

    overlay.addEventListener("mousedown", v => {
      downTarget = v.target;
    });

    modal.onclick = v => v.stopPropagation();
    modal.append(textarea);
    buttonGroup.append(confirm, cancel);
    modal.append(buttonGroup)
    overlay.append(modal);
    document.body.append(overlay);
  }

  async function send() {
    if (cfg.api_key == "") {
      alert("ËØ∑ÂÖàËÆæÁΩÆ api key");
      return
    }

    const input = document.querySelector("#input");

    if (!input.innerText.trim()) return;
    if (document.querySelector("button").disabled) return;

    cfg.messages.push({ role: "user", content: input.innerText });
    input.innerText = "";
    document.querySelectorAll("button").forEach(v => v.disabled = true);
    render();

    try {
      cfg.messages.push({ role: "assistant", content: "" });
      render();

      const response = await fetch(cfg.api_base, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${cfg.api_key}`
        },
        body: JSON.stringify({ ...cfg })
      });

      if (!response.ok) throw new Error(`ËØ∑Ê±ÇÂ§±Ë¥•: ${await response.text()}`);

      const reader = response.body.getReader();
      const decoder = new TextDecoder();
      const assistantMessage = cfg.messages[cfg.messages.length - 1];

      let flag = true

      while (true) {
        const { done, value } = await reader.read();
        if (done) break;

        const chunks = decoder.decode(value).split("\n\n");

        for (const chunk of chunks) {
          const line = chunk.trim();
          if (!line || line == "data: [DONE]") continue;

          try {
            const data = JSON.parse(line.replace("data: ", ""));
            const reasoning_content = data.choices[0].delta.reasoning_content;
            const content = data.choices[0].delta.content || "";

            if (reasoning_content == undefined && flag) {
              assistantMessage.content = ""
              flag = false;
            };

            assistantMessage.content += reasoning_content || content;
            render();
          } catch (v) {
            console.error("JSON Ëß£ÊûêÈîôËØØ:", v);
          }
        }
      }
    } catch (v) {
      alert(v.message);
      cfg.messages.pop();
      cfg.messages.pop();
    } finally {
      document.querySelectorAll("button").forEach(v => v.disabled = false);
      render();
    }
  }

  render();
</script>

</html>